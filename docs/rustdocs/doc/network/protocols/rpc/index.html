<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `rpc` mod in crate `network`."><meta name="keywords" content="rust, rustlang, rust-lang, rpc"><title>network::protocols::rpc - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css"><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script src="../../../storage.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="shortcut icon" href="../../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../../network/index.html'><div class='logo-container'><img src='../../../rust-logo.png' alt='logo'></div></a><p class='location'>Module rpc</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><p class='location'><a href='../../index.html'>network</a>::<wbr><a href='../index.html'>protocols</a></p><script>window.sidebarCurrent = {name: 'rpc', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../../settings.html"><img src="../../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../../src/network/protocols/rpc/mod.rs.html#4-494' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../../index.html'>network</a>::<wbr><a href='../index.html'>protocols</a>::<wbr><a class="mod" href=''>rpc</a></span></h1><div class='docblock'><p>Protocol for making and handling Remote Procedure Calls</p>
<h1 id="slurp-simple-libra-unary-rpc-protocol" class="section-header"><a href="#slurp-simple-libra-unary-rpc-protocol">SLURP: Simple Libra Unary Rpc Protocol</a></h1>
<p>SLURP takes advantage of <a href="../../../netcore/multiplexing/index.html">muxers</a> and <a href="../../../netcore/negotiate/index.html">substream negotiation</a> to build a
simple rpc protocol. Concretely,</p>
<ol>
<li>Every rpc call runs in its own substream. Instead of managing a completion
queue of message ids, we instead delegate this handling to the muxer so
that the underlying substream controls the lifetime of the rpc call.
Additionally, on certain transports (e.g., QUIC) we avoid head-of-line
blocking as the substreams are independent.</li>
<li>An rpc method call negotiates which method to call using <a href="../../../netcore/negotiate/index.html"><code>protocol-select</code></a>.
This allows simple versioning of rpc methods and negotiation of which
methods are supported. In the future, we can potentially support multiple
backwards-incompatible versions of any rpc method.</li>
<li>The actual structure of the request/response wire messages is left for
higher layers to specify. The rpc protocol is only concerned with shipping
around opaque blobs. Current libra rpc clients (consensus, mempool) mostly
send protobuf enums around over a single rpc protocol,
e.g., <code>/libra/consensus/rpc/0.1.0</code>.</li>
</ol>
<h2 id="wire-protocol-dialer" class="section-header"><a href="#wire-protocol-dialer">Wire Protocol (dialer):</a></h2>
<p>To make an rpc request to a remote peer, the dialer</p>
<ol>
<li>Requests a new outbound substream from the muxer.</li>
<li>Negotiates the substream using <a href="../../../netcore/negotiate/index.html"><code>protocol-select</code></a> to the rpc method they
wish to call, e.g., <code>/libra/mempool/rpc/0.1.0</code>.</li>
<li>Sends the serialized request arguments on the newly negotiated substream.</li>
<li>Half-closes their output side.</li>
<li>Awaits the serialized response message from remote.</li>
<li>Awaits the listener's half-close to complete the substream close.</li>
</ol>
<h2 id="wire-protocol-listener" class="section-header"><a href="#wire-protocol-listener">Wire Protocol (listener):</a></h2>
<p>To handle new rpc requests from remote peers, the listener</p>
<ol>
<li>Polls for new inbound substreams on the muxer.</li>
<li>Negotiates inbound substreams using <a href="../../../netcore/negotiate/index.html"><code>protocol-select</code></a>. The negotiation
must only succeed if the requested rpc method is actually supported.</li>
<li>Awaits the serialized request arguments on the newly negotiated substream.</li>
<li>Awaits the dialer's half-close.</li>
<li>Handles the request by sending it up through the
<a href="crate::interface::NetworkProvider"><code>NetworkProvider</code></a>
actor to a higher layer rpc client like consensus or mempool, who then
sends the serialed rpc response back down to the rpc layer.</li>
<li>Sends the serialized response message to the dialer.</li>
<li>Half-closes their output side to complete the substream close.</li>
</ol>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="error/index.html" title='network::protocols::rpc::error mod'>error</a></td><td class='docblock-short'><p>Rpc protocol errors</p>
</td></tr><tr class='module-item'><td><a class="mod" href="fuzzing/index.html" title='network::protocols::rpc::fuzzing mod'>fuzzing</a></td><td class='docblock-short'><p>fuzzing module for the rpc protocol</p>
</td></tr><tr class='module-item'><td><a class="mod" href="utils/index.html" title='network::protocols::rpc::utils mod'>utils</a></td><td class='docblock-short'></td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.InboundRpcRequest.html" title='network::protocols::rpc::InboundRpcRequest struct'>InboundRpcRequest</a></td><td class='docblock-short'><p>A wrapper struct for an inbound rpc request and its associated context.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.OutboundRpcRequest.html" title='network::protocols::rpc::OutboundRpcRequest struct'>OutboundRpcRequest</a></td><td class='docblock-short'><p>A wrapper struct for an outbound rpc request and its associated context.</p>
</td></tr><tr class='module-item'><td><a class="struct" href="struct.Rpc.html" title='network::protocols::rpc::Rpc struct'>Rpc</a></td><td class='docblock-short'><p>The rpc actor.</p>
</td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.RpcNotification.html" title='network::protocols::rpc::RpcNotification enum'>RpcNotification</a></td><td class='docblock-short'><p>Events sent from the [<code>Rpc</code>] actor to the
<a href="crate::interface::NetworkProvider"><code>NetworkProvider</code></a> actor.</p>
</td></tr><tr class='module-item'><td><a class="enum" href="enum.RpcRequest.html" title='network::protocols::rpc::RpcRequest enum'>RpcRequest</a></td><td class='docblock-short'><p>Events sent from the <a href="crate::interface::NetworkProvider"><code>NetworkProvider</code></a>
actor to the [<code>Rpc</code>] actor.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g., <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g., <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g., <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../../../";window.currentCrate = "network";</script><script src="../../../aliases.js"></script><script src="../../../main.js"></script><script defer src="../../../search-index.js"></script></body></html>